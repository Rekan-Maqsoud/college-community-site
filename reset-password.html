<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting to College Community...</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: white;
            text-align: center;
            padding: 20px;
        }
        .container {
            max-width: 400px;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(187, 134, 252, 0.3);
            border-top-color: #BB86FC;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        h1 { font-size: 24px; margin-bottom: 12px; }
        p { color: rgba(255,255,255,0.7); margin-bottom: 24px; }
        .btn {
            display: inline-block;
            background: linear-gradient(90deg, #BB86FC, #9D4EDD);
            color: white;
            padding: 14px 32px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(187, 134, 252, 0.4);
        }
        .error { display: none; }
        .error.show { display: block; }
        .error p { color: #ff6b6b; }
    </style>
</head>
<body>
    <div class="container">
        <div id="loading">
            <div class="spinner"></div>
            <h1>Redirecting to App...</h1>
            <p>Opening College Community to reset your password</p>
        </div>
        <div id="error" class="error">
            <h1>Open in App</h1>
            <p>Tap the button below to reset your password in the College Community app</p>
            <a id="manualLink" class="btn" href="#">Open App</a>
        </div>
    </div>

    <script>
        (function() {
            // Get URL parameters
            const params = new URLSearchParams(window.location.search);
            const userId = params.get('userId');
            const secret = params.get('secret');

            if (!userId || !secret) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').classList.add('show');
                document.querySelector('#error p').textContent = 'Invalid or expired reset link. Please request a new password reset from the app.';
                document.getElementById('manualLink').href = 'collegecommunity://';
                document.getElementById('manualLink').textContent = 'Open App';
                return;
            }

            // Build the deep link
            const deepLink = `collegecommunity://reset-password?userId=${encodeURIComponent(userId)}&secret=${encodeURIComponent(secret)}`;
            
            // Set up the manual button
            document.getElementById('manualLink').href = deepLink;

            // Try to redirect automatically
            window.location.href = deepLink;

            // If still here after 2 seconds, show manual button
            setTimeout(function() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').classList.add('show');
            }, 2000);
        })();
    </script>
</body>
</html>